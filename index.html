<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chess Game</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
            font-family: Arial, sans-serif;
        }

        #game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #board {
            display: grid;
            grid-template-columns: repeat(9, auto);
            grid-template-rows: repeat(9, auto);
            gap: 1px;
            background-color: #000;
            padding: 1px;
            border: 2px solid #333;
        }

        .square {
            width: 60px;
            height: 60px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 40px;
            user-select: none;
        }

        .light { background-color: #f0d9b5; }
        .dark { background-color: #b58863; }

        .coordinate {
            width: 20px;
            height: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 12px;
            background-color: #f0f0f0;
        }

        .piece {
            cursor: grab;
        }

        .piece:active {
            cursor: grabbing;
        }

        #turn {
            margin-top: 20px;
            font-size: 24px;
            text-align: center;
        }

        #debug {
            margin-top: 20px;
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="board"></div>
        <div id="turn"></div>
    </div>
    <div id="debug"></div>
    <script>
        const BOARD_SIZE = 8;
        let board = Array(BOARD_SIZE).fill().map(() => Array(BOARD_SIZE).fill(' '));
        let isWhiteTurn = true;

        const PIECES = {
            'K': '♔', 'Q': '♕', 'R': '♖', 'B': '♗', 'N': '♘', 'P': '♙',
            'k': '♚', 'q': '♛', 'r': '♜', 'b': '♝', 'n': '♞', 'p': '♟'
        };

        function debug(message) {
            console.log(message);
            const debugElement = document.getElementById('debug');
            if (debugElement) {
                debugElement.innerHTML += message + '<br>';
            }
        }

        function initializeBoard() {
            board = [
                ['r', 'n', 'b', 'q', 'k', 'b', 'n', 'r'],
                ['p', 'p', 'p', 'p', 'p', 'p', 'p', 'p'],
                [' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
                [' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
                [' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
                [' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
                ['P', 'P', 'P', 'P', 'P', 'P', 'P', 'P'],
                ['R', 'N', 'B', 'Q', 'K', 'B', 'N', 'R']
            ];
            debug("Board initialized");
        }

        function createBoardDOM() {
            debug("Creating board DOM");
            const boardElement = document.getElementById('board');
            if (!boardElement) {
                debug("Board element not found in createBoardDOM");
                return;
            }
            boardElement.innerHTML = '';

            // Add top coordinates
            boardElement.appendChild(createCoordinate(''));
            for (let i = 0; i < BOARD_SIZE; i++) {
                boardElement.appendChild(createCoordinate(String.fromCharCode(97 + i)));
            }

            for (let i = 0; i < BOARD_SIZE; i++) {
                // Add left coordinates
                boardElement.appendChild(createCoordinate(8 - i));

                for (let j = 0; j < BOARD_SIZE; j++) {
                    const square = document.createElement('div');
                    square.id = `${String.fromCharCode(97 + j)}${8 - i}`;
                    square.classList.add('square');
                    square.classList.add((i + j) % 2 === 0 ? 'light' : 'dark');
                    square.addEventListener('dragover', allowDrop);
                    square.addEventListener('drop', drop);
                    boardElement.appendChild(square);
                }
            }
            debug("Board DOM created");
        }

        function createCoordinate(text) {
            const coordinate = document.createElement('div');
            coordinate.classList.add('coordinate');
            coordinate.textContent = text;
            return coordinate;
        }

        function updateBoard() {
            debug("Updating board...");
            for (let i = 0; i < BOARD_SIZE; i++) {
                for (let j = 0; j < BOARD_SIZE; j++) {
                    const squareId = `${String.fromCharCode(97 + j)}${8 - i}`;
                    const square = document.getElementById(squareId);
                    if (square) {
                        square.innerHTML = '';
                        const piece = board[i][j];
                        if (piece !== ' ') {
                            const pieceElement = document.createElement('div');
                            pieceElement.classList.add('piece');
                            pieceElement.textContent = PIECES[piece];
                            pieceElement.draggable = true;
                            pieceElement.addEventListener('dragstart', drag);
                            square.appendChild(pieceElement);
                        }
                        square.style.backgroundColor = ''; // Reset background color
                    }
                }
            }
            const turnElement = document.getElementById('turn');
            if (turnElement) {
                turnElement.textContent = isWhiteTurn ? "White's turn" : "Black's turn";
            }
            debug("Board updated");
        }

        function drag(event) {
            event.dataTransfer.setData("text", event.target.parentNode.id);
        }

        function allowDrop(event) {
            event.preventDefault();
        }

        function drop(event) {
            event.preventDefault();
            const fromSquareId = event.dataTransfer.getData("text");
            const toSquareId = event.target.closest('.square').id;
            const move = `${fromSquareId}-${toSquareId}`;
            
            if (isValidMove(move)) {
                makeMove(move);
                isWhiteTurn = !isWhiteTurn;
                updateBoard();
            } else {
                debug("Invalid move");
            }
        }

        function isValidMove(move) {
            // Implement move validation logic here
            return true; // For now, all moves are considered valid
        }

        function makeMove(move) {
            const [from, to] = move.split('-');
            const [fromFile, fromRank] = [from.charCodeAt(0) - 97, 8 - parseInt(from[1])];
            const [toFile, toRank] = [to.charCodeAt(0) - 97, 8 - parseInt(to[1])];

            board[toRank][toFile] = board[fromRank][fromFile];
            board[fromRank][fromFile] = ' ';
            debug(`Move made: ${move}`);
        }

        window.onload = function() {
            debug("Window loaded");
            createBoardDOM();
            initializeBoard();
            updateBoard();
            debug("Initialization complete");
        };
    </script>
</body>
</html>
